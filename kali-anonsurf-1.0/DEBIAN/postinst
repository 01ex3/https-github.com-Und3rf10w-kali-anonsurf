if [ -e /etc/tor/torrc ]; then
 mv /etc/tor/torrc /etc/tor/torrc.orig
fi
if [ -e /etc/tor/torrc.anon ]; then
 mv /etc/tor/torrc.anon /etc/tor/torrc
fi

# Get username and password from user
read -p "What's your PIA Username?: " piausr

# POSIX compliant password reader
stty -echo
printf "What's your PIA Password?: "
read piapass
stty echo
printf "\n"

# Create authentication file for PIA VPNs
echo -e "$piausr\n$piapass" > /opt/anonsurf/piavpnconf.d/.authz
chmod 400 /opt/anonsurf/piavpnconf.d/.authz

# Download the latest PIA vpns, set up to automatically authenticate
cd /opt/anonsurf/piavpnconf.d/
wget -q https://www.privateinternetaccess.com/openvpn/openvpn.zip
unzip openvpn.zip >/dev/null
rm openvpn.zip

# Change openvpn configs to to point to full file paths
for file in *.ovpn; do
	echo "auth-user-pass /opt/anonsurf/piavpnconf.d/.authz" >> "$file";
	sed -i 's/ca ca.crt/ca \/opt\/anonsurf\/piavpnconf.d\/ca.crt/' "$file";
	sed -i 's/crl-verify crl.pem/ca \/opt\/anonsurf\/piavpnconf.d\/crl.pem/' "$file";
done
